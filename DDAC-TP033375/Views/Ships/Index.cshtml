@model IEnumerable<DDAC_TP033375.Models.Ship>

@{
	ViewBag.Title = "Index";
}

@if (ViewBag.IsSuccess != null)
{
	if (ViewBag.IsSuccess)
	{
		<div class="alert alert-dismissible alert-success">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			@ViewBag.Message
		</div>
	}
	else
	{
		<div class="alert alert-dismissible alert-danger">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			@ViewBag.Message
		</div>
	}
}

<h2>Index</h2>

<p>
	@Html.ActionLink("Create Ship", "New", "", new { @class = "btn btn-success" })
</p>
<table id="ships" class="table table-striped table-hover">
	<thead>
		<tr>
			<th>
				@Html.DisplayNameFor(model => model.Name)
			</th>
			<th>
				@Html.DisplayNameFor(model => model.NumberOfContainerBay)
			</th>
			<th>
				@Html.DisplayNameFor(model => model.NumberOfAvailableContainerBay)
			</th>
			<th style="text-align: center">
				@Html.DisplayNameFor(model => model.Schedule)
			</th>
			<th></th>
		</tr>
	</thead>

	@foreach (var item in Model)
	{
		<tr>
			<td>
				@Html.DisplayFor(modelItem => item.Name)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.NumberOfContainerBay)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.NumberOfAvailableContainerBay)
			</td>
			<td style="text-align: center">
				@if (item.IsScheduled)
				{
					<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
				}
				else
				{
					<span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
				}
			</td>
			<td>
				@Html.ActionLink("Details", "Details", new { id = item.Id }, new { @class = "label label-primary", data_toggle = "modal", data_target = "#shipDetailsModal" })
				@Html.ActionLink("Edit", "Edit", new { id = item.Id }, new { @class = "label label-warning" })
				<a href="" class="label label-danger js-delete" data-id="@item.Id">Delete</a>
			</td>
		</tr>
	}

</table>

<!-- Modal -->
<div class="modal fade" id="shipDetailsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
		</div>
	</div>
</div>

@section scripts
{
	<script>
		$(document).on('hidden.bs.modal', function (e) {
			$(e.target).removeData('bs.modal');
		});

		$(document).ready(function () {
			$("#ships").on("click", ".js-delete", function (e) {
				e.preventDefault();

				var button = $(this);

				bootbox.confirm("Are you sure you want to delete this ship?",
					function (result) {
						if (result) {
							$.ajax({
								type: "POST",
								url: '@Url.Action("Delete")',
								data: JSON.stringify({ id: button.attr("data-id") }),
								dataType: "json",
								contentType: "application/json; charset=utf-8",
								success: function (response) {
									if (response != null && response.success) {
										button.parents("tr").remove();
										//table.row(button.parents("tr")).remove().draw();
										toastr.success(response.responseText);
									} else {
										toastr.error(response.responseText);
									}
								},
								error: function (response) {
									toastr.error("ERROR!");
								}
							});
						}
					});
			});
		});
	</script>
}